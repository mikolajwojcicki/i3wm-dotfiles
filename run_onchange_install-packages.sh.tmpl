#!/bin/bash

# Hash poniżej służy do tego, aby chezmoi wiedziało, kiedy pakiety się zmieniły
# packages: i3, polybar, rofi, kitty, dunst, picom, thunar, etc. v2

echo "Rozpoczynam instalację i naprawę zależności..."

sudo zypper refresh

# --- FIX 1: Konflikt Power Management ---
# Jeśli tuned jest zainstalowany, usuwamy go, aby zrobić miejsce dla tlp (lepsze dla ThinkPada)
if rpm -q tuned &> /dev/null; then
    echo "Wykryto konflikt: usuwanie 'tuned' na rzecz 'tlp'..."
    sudo zypper remove -y tuned
fi

# --- FIX 2: i3-gaps jest teraz w i3 ---
# 1. Rdzeń środowiska
# Usunięto 'i3-gaps', zostawiono samo 'i3' (funkcjonalność została scalona)
sudo zypper install -y i3 polybar rofi picom dunst

# 2. Narzędzia systemowe
sudo zypper install -y NetworkManager-applet blueman pavucontrol brightnessctl feh arandr autorandr

# 3. Wygląd i aplikacje
sudo zypper install -y lxappearance thunar kitty polkit-gnome

# 4. Czcionki i ikony
sudo zypper install -y fontawesome-fonts jetbrains-mono-fonts papirus-icon-theme

# 5. Specyficzne dla ThinkPada i openSUSE
sudo zypper install -y tlp intel-media-driver

echo "Instalacja pakietów zakończona pomyślnie."
